version: 3.8

# guide : https://medium.com/swlh/how-to-deploy-django-rest-framework-and-react-redux-application-with-docker-fa902a611abf
# check nginx config

services:
  django:
    build:
      context: ./backend
    env_file: 
      - ./backend/.env
    # args:
    #   EMAIL_USERNAME: *
    #   EMAIL_PASSWORD: *
    #   SECRET_KEY: *
    #   DEBUG: *
    #   ALLOWED_HOSTS: *
    #   DATABASE_NAME: *
    #   DATABASE_USERNAME: *
    #   DATABASE_PASSWORD: *
    #   DATABASE_HOST: *
    #   DATABASE_PORT: *
    #   AWS_ACCESS_KEY_ID: *
    #   AWS_SECRET_ACCESS_KEY: *
    #   AWS_STORAGE_BUCKET_NAME: *
    #   AWS_S3_REGION_NAME: *
    #   AWS_LOCATION: *
    #   CELERY_BROKER_URL: *
    #   CORS_ALLOWED_ORIGINS: *
    container_name: django
    command: gunicorn backend.wsgi --bind 0.0.0.0:8000
    volumes:
      - .:/usr/surc/vibro/
    ports:
      - "8000:8000"
  react:
    build:
      context: ./frontend
    env_file: 
      - ./frontend/.env
    # args:
    #   API_URL: *
    volumes:
      - build_folder:/frontend/build
  
  nginx:
    image: nginx: latest
    ports:
      - 80:8080
    volumes:
      - ./webserver/nginx-proxy.conf:/etc/nginx/conf.d/default.conf:ro
      - build_folder:/var/www/frontend 
    depends_on:
      - django
      - react
volumes:
  build_folder:

    
